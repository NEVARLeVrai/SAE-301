{#
    ===========================================
    MES FAVORIS (US-16)
    ===========================================
    Liste des cours et articles favoris de l'utilisateur.
    Variables : favorite_courses, favorite_articles, current_type, user_logged_in
#}
{% extends 'base.twig' %}

{% block title %} - Mes Favoris{% endblock %}

{% block content %}
<h1>Mes Favoris</h1>

{% if not user_logged_in %}
    <div class="alert alert-warning">
        <p>Vous devez être connecté pour accéder à vos favoris.</p>
        <a href="index.php?action=login" class="btn">Se connecter</a>
    </div>
{% else %}

    {# Navigation par onglets #}
    <div class="tabs mb-3">
        <a href="index.php?action=my_favorites&type=course" class="btn {{ (current_type is not defined or current_type == 'course') ? 'btn-primary' : 'btn-secondary' }}">
            Cours favoris
        </a>
        <a href="index.php?action=my_favorites&type=article" class="btn {{ (current_type is defined and current_type == 'article') ? 'btn-primary' : 'btn-secondary' }}">
            Articles favoris
        </a>
    </div>

    {% if current_type is not defined or current_type == 'course' %}
        {# Liste des cours favoris #}
        <h2>Mes Cours Favoris</h2>
        {% if favorite_courses is defined and favorite_courses|length > 0 %}
            <div class="grid-3">
                {% for cours in favorite_courses %}
                    <div class="card">
                        <h3>{{ cours.title }}</h3>
                        <p class="card-meta">
                            <strong>Instrument :</strong> {{ cours.instrument }} | 
                            <strong>Niveau :</strong> {{ cours.level }}
                        </p>
                        <p>{{ cours.description|slice(0, 100) }}...</p>
                        <small>Par {{ cours.author ?? 'Anonyme' }}</small>
                        <div class="card-actions mt-2">
                            <a href="index.php?action=cours_details&id={{ cours.id }}" class="btn-small">Voir</a>
                            <a href="index.php?action=remove_favorite&item_id={{ cours.id }}&item_type=course" class="btn-small btn-danger" onclick="return confirm('Retirer des favoris ?');">
                                ❌ Retirer
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">Aucun cours en favoris.</p>
            <a href="index.php?action=cours" class="btn">Découvrir les cours</a>
        {% endif %}

    {% else %}
        {# Liste des articles favoris #}
        <h2>Mes Articles Favoris</h2>
        {% if favorite_articles is defined and favorite_articles|length > 0 %}
            <div class="grid-3">
                {% for article in favorite_articles %}
                    <div class="card">
                        {% if article.image_url %}
                            <img src="../../assets/{{ article.image_url }}" alt="Image" class="card-img">
                        {% endif %}
                        <h3>{{ article.title }}</h3>
                        <small>Par {{ article.author ?? 'Anonyme' }} le {{ article.created_at|date('d/m/Y') }}</small>
                        <p>{{ article.content|striptags|slice(0, 100) }}...</p>
                        <div class="card-actions mt-2">
                            <a href="index.php?action=article_details&id={{ article.id }}" class="btn-small">Lire</a>
                            <a href="index.php?action=remove_favorite&item_id={{ article.id }}&item_type=article" class="btn-small btn-danger" onclick="return confirm('Retirer des favoris ?');">
                                ❌ Retirer
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">Aucun article en favoris.</p>
            <a href="index.php?action=blog" class="btn">Découvrir le blog</a>
        {% endif %}
    {% endif %}

{% endif %}
{% endblock %}
